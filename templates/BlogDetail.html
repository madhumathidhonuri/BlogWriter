{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ blog.title }} - My AI Blog</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand" href="{% url 'HomePage' %}">My AI Blog</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        {% if user.is_authenticated %}
          <li class="nav-item"><a class="nav-link disabled" href="#">Hi, {{ user.username }}</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Logout</a></li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'register' %}">Register</a></li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<div class="container my-5">
    <div class="card shadow p-4">
        <!-- Blog Title & Info -->
        <h1 class="card-title">{{ blog.title }}</h1>
        <p class="text-muted">
            By {{ blog.author.username }} | Reading Time: {{ blog.reading_time }} min
        </p>
        <hr>

        <!-- Blog Content -->
        <div class="card-text mb-4">{{ blog.content|linebreaks }}</div>

        <!-- TL;DR & Text-to-Speech Buttons -->
        <div class="mb-4">
            <button id="tldr-btn" class="btn btn-warning me-2">TL;DR</button>
            <button id="tts-btn" class="btn btn-info">Listen</button>
            <div id="tldr-result" class="mt-2"></div>
        </div>

        <!-- Tags -->
        {% if blog.tags.all %}
        <p>
            Tags:
            {% for tag in blog.tags.all %}
                <span class="badge bg-secondary">{{ tag.name }}</span>
            {% endfor %}
        </p>
        {% endif %}

        <!-- Edit & Delete buttons for author -->
        {% if user.is_authenticated and blog.author == user %}
        <div class="mb-3">
            <a href="{% url 'EditBlog' blog.id %}" class="btn btn-warning me-2">Edit</a>
            <a href="{% url 'DeleteBlog' blog.id %}" class="btn btn-danger">Delete</a>
        </div>
        {% endif %}

        <!-- Recommended Blogs -->
        <h5 class="mt-4">Recommended for you</h5>
        <div class="row">
            {% for related in related_blogs %}
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <a href="{% url 'BlogDetail' related.id %}">{{ related.title }}</a>
                    </div>
                </div>
            </div>
            {% empty %}
                <p>No recommendations available.</p>
            {% endfor %}
        </div>

        <!-- Back to Home -->
        <a href="{% url 'HomePage' %}" class="btn btn-primary mt-3">Back to Home</a>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Text-to-Speech
    document.getElementById('tts-btn').addEventListener('click', () => {
        const msg = new SpeechSynthesisUtterance(`{{ blog.content|escapejs }}`);
        window.speechSynthesis.speak(msg);
    });

    // TL;DR - fetch from backend (Hugging Face)
    document.getElementById('tldr-btn').addEventListener('click', async () => {
        const response = await fetch("{% url 'blog_tldr' blog.id %}");
        const data = await response.json();
        document.getElementById('tldr-result').innerText = data.summary;
    });
</script>

</body>
</html>
